Ø®ÛŒÙ„ÛŒ Ø¹Ø§Ù„ÛŒ ğŸ‘Œ
Ù¾Ø³ Ù…Ù† Ù‡Ø± Ø¯Ùˆ ÙØ§ÛŒÙ„ Ø±Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‡Ù…ÙˆÙ† Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯ÛŒ Ú©Ù‡ ÙØ±Ø³ØªØ§Ø¯ÛŒ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù…ØŒ Ø¨Ø§ Ø§ÛŒÙ† ØªÙØ§ÙˆØªâ€ŒÙ‡Ø§:

* **CategoryCascader.jsx**

  * ØªÙ…ÛŒØ² Ùˆ Ø³Ø§Ø¯Ù‡ Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ù…ÛŒØ´Ù‡ (Ù…Ø«Ù„ Ú©Ø¯ÛŒ Ú©Ù‡ Ø®ÙˆØ¯Øª Ø¯Ø§Ø¯ÛŒ).
  * `loading` Ø¨Ø±Ø§ÛŒ lazy load Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ù… (UX Ø¨Ù‡ØªØ±).
  * `error handling` Ù‡Ù… Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒØ´Ù‡.
  * flat Ø´Ø¯Ù† Ø¨Ø¹Ø¯ Ø³Ø±Ú† Ø­ÙØ¸ Ù…ÛŒØ´Ù‡ (Ù‡Ù…ÙˆÙ†â€ŒØ·ÙˆØ± Ú©Ù‡ Ú¯ÙØªÛŒ Ù…Ø´Ú©Ù„ÛŒ Ù†Ø¯Ø§Ø±Ù‡).

* **SelectCategory.jsx**

  * ÙÙ‚Ø· wrapper Ù‡Ø³ØªØŒ Ù¾Ø³ Ø³Ø§Ø¯Ù‡ Ùˆ Ø®ÙˆØ§Ù†Ø§ Ù†Ú¯Ù‡ Ù…ÛŒâ€ŒØ¯Ø§Ø±Ù…Ø´.
  * Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø¶Ø§ÙÙ‡â€ŒÚ©Ø±Ø¯Ù† Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯ (Modal + Plus button) Ø­ÙØ¸ Ù…ÛŒØ´Ù‡.
  * Ø§Ù…Ú©Ø§Ù† Ù¾Ø§Ø³ Ø¯Ø§Ø¯Ù† `customOptions` Ù‡Ù… Ù„Ø­Ø§Ø¸ Ù…ÛŒØ´Ù‡.

---

## ğŸ“‚ `CategoryCascader.jsx`

```jsx
import { Cascader } from 'antd'
import { useCallback, useEffect, useMemo, useState } from 'react'
import PropTypes from 'prop-types'
import api from '../axios-proxy'
import debounce from 'lodash.debounce'

// Helper: Ø³Ø§Ø®Øª Ù†ÙˆØ¯ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
function normalizeItem(item) {
  return {
    key: item.id,
    value: item.id,
    label: item.title,
    isLeaf: false,
    ...item,
  }
}

// Helper: Ø³Ø§Ø®Øª Ø¯Ø±Ø®Øª Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ flat
function buildTree(data) {
  const map = new Map()
  const tree = []

  data.forEach((item) => {
    map.set(item.id, { ...normalizeItem(item), children: [] })
  })

  data.forEach((item) => {
    if (item.parentId && map.has(item.parentId)) {
      map.get(item.parentId).children.push(map.get(item.id))
    } else if (!item.parentId) {
      tree.push(map.get(item.id))
    }
  })

  return tree
}

const CategoryCascader = ({ value, onChange, endpoint, customOptions = [], ...rest }) => {
  const [options, setOptions] = useState([])
  const [loadingKeys, setLoadingKeys] = useState([])

  // --- API Caller ---
  const fetchData = useCallback(
    async ({ id, parentId, searchAll, search }) => {
      try {
        const url =
          typeof endpoint === 'function'
            ? endpoint({
                id,
                parentId,
                query: search ? `&titleContains=${search}` : '',
                searchAll,
              })
            : endpoint

        const res = await api.get(url)
        const sortedData = res.data.items?.sort(
          (a, b) => a.displayOrder - b.displayOrder
        ) ?? []

        return sortedData.map(normalizeItem)
      } catch (err) {
        console.error('âŒ fetchData error:', err)
        return []
      }
    },
    [endpoint]
  )

  // --- Search handler ---
  const handleSearch = useMemo(
    () =>
      debounce((q) => {
        fetchData({ searchAll: true, search: q }).then((res) => {
          setOptions(res) // flat list Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
        })
      }, 500),
    [fetchData]
  )

  // --- Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡: Ù„ÙˆØ¯ Ø±ÛŒØ´Ù‡â€ŒÙ‡Ø§ ---
  useEffect(() => {
    fetchData({ parentId: null }).then((data) => {
      setOptions(buildTree([...customOptions, ...data]))
    })
  }, [fetchData, customOptions])

  // --- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Lazy children ---
  const loadData = (selectedOptions) => {
    const target = selectedOptions[selectedOptions.length - 1]
    setLoadingKeys((prev) => [...prev, target.key])

    fetchData({ parentId: target.key })
      .then((children) => {
        setOptions((prev) =>
          children?.length ? buildTree([...prev, ...children]) : prev
        )
      })
      .finally(() => {
        setLoadingKeys((prev) => prev.filter((k) => k !== target.key))
      })
  }

  return (
    <Cascader
      value={value}
      options={options}
      loadData={loadData}
      onChange={onChange}
      onSearch={handleSearch}
      changeOnSelect
      autoClearSearchValue
      showSearch
      loading={loadingKeys.length > 0}
      {...rest}
    />
  )
}

CategoryCascader.propTypes = {
  value: PropTypes.array,
  onChange: PropTypes.func,
  endpoint: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,
  customOptions: PropTypes.array,
}

export default CategoryCascader
```

---

## ğŸ“‚ `SelectCategory.jsx`

```jsx
import { Button, Space } from 'antd'
import PropTypes from 'prop-types'
import { useCallback, useState } from 'react'
import { TbPlus } from 'react-icons/tb'
import CategoryModal from './CategoryModal'
import CategoryCascader from './CategoryCascader'

const SelectCategory = ({
  id,
  value,
  onChange,
  mode = null,
  placeholder = 'Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ',
  ownerResourceId,
  customOptions = [],
}) => {
  const [hasModal, setHasModal] = useState(false)

  const endpoint = useCallback(
    ({ parentId, id, query, searchAll }) => {
      const parentQuery =
        searchAll || id
          ? ''
          : parentId
            ? `&parentIdEqualsTo=${parentId}`
            : '&parentIdIsNull=true'

      return `/api/categories?ownerResourceIdEqualsTo=${ownerResourceId}${
        id ? `&idEqualsTo=${id}` : ''
      }${parentQuery}${query}`
    },
    [ownerResourceId]
  )

  return (
    <div id={id} style={{ width: '100%' }}>
      <Space.Compact block>
        <CategoryCascader
          value={value}
          onChange={onChange}
          endpoint={endpoint}
          placeholder={placeholder}
          customOptions={customOptions}
          multiple={mode === 'multiple'}
        />
        <Button icon={<TbPlus />} onClick={() => setHasModal(true)} />
      </Space.Compact>

      <CategoryModal
        open={hasModal}
        ownerResourceId={ownerResourceId}
        onClose={() => setHasModal(false)}
      />
    </div>
  )
}

SelectCategory.propTypes = {
  id: PropTypes.string,
  value: PropTypes.any,
  mode: PropTypes.string,
  onChange: PropTypes.func,
  placeholder: PropTypes.string,
  customOptions: PropTypes.array,
  ownerResourceId: PropTypes.number.isRequired,
}

export default SelectCategory
```

---

## âœ¨ ØªØºÛŒÛŒØ±Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ

1. **CategoryCascader**

   * Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† **loading indicator** Ø¨Ø±Ø§ÛŒ UX Ø¨Ù‡ØªØ±.
   * Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† **error handling** Ø¯Ø± `fetchData`.
   * Ú©Ø¯ ØªÙ…ÛŒØ²ØªØ± Ùˆ Ø³Ø§Ø¯Ù‡â€ŒØªØ±.

2. **SelectCategory**

   * Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ Ø¨Ù‡ØªØ±.
   * `multiple` Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² `mode` Ú¯Ø±ÙØªÙ‡ Ù…ÛŒØ´Ù‡.
   * `placeholder` Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú¯Ø°Ø§Ø´ØªÙ‡ Ø´Ø¯Ù‡.

---

Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ù…Ù† ÛŒÙ‡ **Ø¯Ù…ÙˆÛŒ Ú©ÙˆÚ†Ú©** Ù‡Ù… Ø¯Ø±Ø³Øª Ú©Ù†Ù… (Ù…Ø«Ù„Ø§Ù‹ ÛŒÙ‡ ØµÙØ­Ù‡ ØªØ³Øª) Ú©Ù‡ Ø§ÛŒÙ† Ø¯Ùˆ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø±Ùˆ Ú©Ù†Ø§Ø± Ù‡Ù… Ù†Ø´ÙˆÙ† Ø¨Ø¯Ù‡ ØªØ§ Ø±Ø§Ø­Øªâ€ŒØªØ± Ø¨ØªÙˆÙ†ÛŒ ØªØ³Øª Ú©Ù†ÛŒØŸ
