ุฎู ุนุงูู ฺฉู ููุงุฑุฏ ฑ ุชุง ณ ุฑู ุจุฑุฑุณ ฺฉุฑุฏ ู ฺฏูุช ฺฉู ุฑุนุงุช ุดุฏู. ุงูฺฉู **ูุดฺฉู ููุท ุฏุฑ ฺฉ ุชุจ ู ุฏุฑ ูุญุท ูุงูุน (production)** ุฑุฎ ูโุฏู ูุดูู ูโุฏู ฺฉู Web Locks API ููฺฉูู ุฏุฑ ุงูู ูุญุท **ุบุฑูุนุงู** ุจุงุดู ุง **ุฑูุชุงุฑ ูุชูุงูุช ุฏุงุดุชู ุจุงุดู**.

ุญุงูุง ุจุฑู ุณุฑุงุบ **ฺฏุฒูู ด** (ูุญุท deployment ู CDNูุง) ู ุงูู ุฑู ุฏููโุชุฑ ุจุฑุฑุณ ฺฉูู:

---

## โ ููุฑุฏ ด: ูุญุท deploy ู ุชุงุซุฑุด ุฑู Web Locks API

### ๐ ููุถูุน ฺูุ

ุจุฑุฎ ูุญุทโูุง ุงุณุชูุฑุงุฑ (CDNุ reverse proxyุ ุณุฑูุณโูุง ูุงุณุช ูุซู Vercelุ Netlifyุ Cloudflare Pagesุ Azure Static Web Apps ู ...) ููฺฉูู ุจุงุนุซ ุจุดู:

* ุตูุญู ุดูุง ุฏุฑ **Secure Context ูุงูุน** ุงุฌุฑุง ูุดู.
* ุง ุฑูุชุงุฑ ุจุฑุฎ Web API ูุง ูุซู `navigator.locks` ุบุฑูุนุงู ุจุดู ุง ุบุฑูุงุจู ูพุดโุจู ุจุดู.
* ุง ุชูุธูุงุช `Content-Security-Policy (CSP)` ุง `Sandboxing` ุจุงุนุซ ูุญุฏูุฏ ุดุฏู APIูุง ุจุดู.

---

## ๐งช ุชุณุช ุนูู ุจุฑุง ุงู ูุฑุถู:

ุฏุฑ ูุญุท production (ุฑู ูุฑูุฑฺฏุฑ ฺฉูุงูุช)ุ ุฏุฑ DevTools Consoleุ ุงู ุฏู ููุฑุฏ ุฑู ุจุฑุฑุณ ฺฉู:

### 1. ุขุง `navigator.locks` ูุฌูุฏ ุฏุงุฑุฏุ

```js
console.log(navigator.locks);  // ุจุงุฏ ฺฉ Object ุจุงุดุฏุ ูู undefined
```

> ุงฺฏุฑ `undefined` ุจูุฏุ ุนู ูุฑูุฑฺฏุฑ (ุฏุฑ ุงูู ฺฉุงูุชฺฉุณุช) Web Locks API ุฑู ุบุฑูุนุงู ฺฉุฑุฏู.

---

### 2. ุชุณุช ูุณุชูู ููู:

```js
navigator.locks.request('test-lock', async () => {
  console.log('Web Locks API works!');
});
```

> ุงฺฏุฑ ุงู ูพุงู ุฏุฑ Console ฺุงูพ ูุดุฏ ุง ุฎุทุง ุฏุฑุงูุช ุดุฏุ ูุดุฎุต ูโุดู ฺฉู API ุบุฑูุนุงูู ุง sandbox ุดุฏู.

---

### 3. ุจุฑุฑุณ Secure Context:

ุฏุฑ ููุงู ุชุจุ ุฏุฑ DevTools Console ุจุฒู:

```js
console.log(window.isSecureContext); // ุจุงุฏ true ุจุงุดุฏ
```

> ุงฺฏุฑ false ุจุงุดูุ ุนู ูุฑูุฑฺฏุฑ ุตูุญู ุฑู ุฏุฑ ฺฉ ฺฉุงูุชฺฉุณุช ุบุฑุงูู ุงุฌุฑุง ฺฉุฑุฏู (ูุซูุงู ุฏุงุฎู ฺฉ iframe sandbox ุดุฏู ุง ุงุฒ ูพุฑูฺฉุณ ูุงููุงููฺฏ ุฑุฏ ุดุฏู).

---

## ๐ ุฏูุงู ุฑุงุฌ ุบุฑูุนุงู ุดุฏู Web Locks API ุฏุฑ ูุญุท production

### โด๏ธ Content-Security-Policy ูุญุฏูุฏฺฉููุฏู

ุงฺฏุฑ CSP ูุฏุฑูุง ุจูโุดุฏุช ูุญุฏูุฏฺฉููุฏู ุจุงุดูุฏุ ููฺฉูู ุจุนุถ APIูุง ุบุฑูุงุจู ุงุณุชูุงุฏู ุจุดู.

ูุซูุงู:

```
Content-Security-Policy: default-src 'self'; script-src 'self'; object-src 'none'; ...
```

**ุฑุงูฺฉุงุฑ:** ุจุฑุฑุณ response header ุฏุฑ DevTools โ Network โ \[ูุงู HTML ุงุตู] โ ุชุจ Headers.

---

### โด๏ธ ุงุณุชูุงุฏู ุงุฒ iframe ุง ูพูุชูุฑูโูุง ฺฉู sandbox ุงุนูุงู ูโฺฉูู

ูุซูุงู ุงฺฏุฑ ุณุงุช ุฏุฑ ฺฉ iframe ุงุฒ ุฏุงููู ุฏฺฏุฑ ุจุงุฑฺฏุฐุงุฑ ุดุฏู ุจุงุดู (ุง ุญุช ุชุจูุบุงุชุ ุจุฎุดโูุง auth ูุซู login via Microsoft ฺฉู ุฏุฑ iframe ูุงุฏ)ุ Web Locks API ุบุฑูุนุงู ูโุดู.

---

### โด๏ธ CDN ุง reverse proxy ุฎุงุต (ูุซูุงู Cloudflare)

ุจุฑุฎ ุงุฒ ุงู ุณุฑูุณโูุง (ุฏุฑ ุดุฑุงุท ุฎุงุต ุง ุจุง ุชูุธูุงุช ุฎุงุต) ููฺฉูู ูุญุชูุง ุฑู ุฏุฑ ุญุงูุช "ุณุฑูุฑ side rendering + caching" ุง ุจุง ุชุบุฑ ุฏุฑ context ุงุฌุฑุง ฺฉูู.

ุจุฑุง ุชุณุชุ ู ูุณุฎู ุบุฑ CDN (ูุณุชูู ุงุฒ ุณุฑูุฑ ุงุตู) ุฑู ุจุงุฑฺฏุฐุงุฑ ฺฉู ู ุจุจู Web Locks API ฺฉุงุฑ ูโฺฉูู ุง ูู.

---

## ๐งฐ ูพุดููุงุฏ ุฑุงูฺฉุงุฑ:

ุงฺฏุฑ ุงุญุชูุงู ูโุฏ ฺฉู Web Locks API ุชู ูุญุท production ุบุฑูุนุงูู ุง ุบุฑูุงุจู ุงุนุชูุงุฏ ูุณุชุ ูโุชูู fallback ุจุฒุงุฑ:

```js
const hasLockAPI = !!(navigator.locks && navigator.locks.request);

async function withRefreshLock(callback) {
  if (hasLockAPI) {
    return navigator.locks.request('refresh-token', callback);
  } else {
    // fallback ุณุงุฏู ุจู Promise lock ุฏุฑ ุณุทุญ global
    if (window._refreshLock) {
      await window._refreshLock;
      return;
    }

    const promise = callback();
    window._refreshLock = promise;
    try {
      return await promise;
    } finally {
      window._refreshLock = null;
    }
  }
}
```

---

## โ ุฌูุนโุจูุฏ

| ููุฑุฏ                              | ุจุฑุฑุณ ฺฉู                                       |
| --------------------------------- | ---------------------------------------------- |
| ุขุง Web Locks API ุบุฑูุนุงููุ       | `navigator.locks` ุฏุฑ DevTools                  |
| ุขุง ฺฉุงูุชฺฉุณุช ุงูู ูุณุชุ              | `window.isSecureContext` ุจุงุฏ `true` ุจุงุดู      |
| ุขุง CSP ูุงูุน ุงุณุชูุงุฏู ูโุดูุ       | ุจุฑุฑุณ ูุฏุฑูุง ุฏุฑ ุชุจ Network                      |
| ุงุฒ CDN/ูพุฑูฺฉุณ ุฎุงุต ุงุณุชูุงุฏู ูโฺฉูุ | ุจุฑุฑุณ ุจุง ูุณุฎู ุจุฏูู CDN ุง ุบุฑูุดุฑุฏูโุดุฏู         |
| ุฑุงูโุญู ุฌุงฺฏุฒู                    | ูพุงุฏูโุณุงุฒ fallback ุฏุฑ ุตูุฑุช ูุจูุฏ Web Locks API |

---

ุงฺฏู ุฎูุงุณุชุ ูโุชูู URL ุชุณุช (ุง ุจุฎุด ุงุฒ ฺฉุฏ frontend deployment) ุฑู ูู ุจุฏ ุชุง ุจุดุชุฑ ุจุฑุฑุณ ฺฉูู.
